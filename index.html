<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨ä¸‹ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚µãƒã‚¤ãƒãƒ«</title>
    <!-- Tailwind CSS (ãƒ‡ã‚¶ã‚¤ãƒ³ç”¨) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM (ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel (ã‚³ãƒ¼ãƒ‰å¤‰æ›ç”¨) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <div id="root" class="w-full max-w-5xl h-[90vh]"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (SVG) ---
        const IconBase = ({ children, color = "currentColor", size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );
        const Briefcase = (p) => <IconBase {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconBase>;
        const MessageCircle = (p) => <IconBase {...p}><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></IconBase>;
        const Coffee = (p) => <IconBase {...p}><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></IconBase>;
        const History = (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/><path d="M12 7v5l4 2"/></IconBase>;
        const UserMinus = (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="22" x2="16" y1="11" y2="11"/></IconBase>;
        const Award = (p) => <IconBase {...p}><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></IconBase>;
        const RefreshCw = (p) => <IconBase {...p}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const TrendingUp = (p) => <IconBase {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconBase>;
        const Zap = (p) => <IconBase {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>;
        const Eye = (p) => <IconBase {...p}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Ghost = (p) => <IconBase {...p}><path d="M9 10h.01"/><path d="M15 10h.01"/><path d="M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"/></IconBase>;

        // --- ã‚²ãƒ¼ãƒ å®šæ•° & ãƒ‡ãƒ¼ã‚¿ ---
        const MAX_WEEKS = 12;

        // çŠ¶æ…‹é…åˆ—ã®é †åºã‚’å¤‰æ›´ï¼šæ™‚è¨ˆå›ã‚Šã«ã€Œè‰¯ããªã‚‹ã€é †åºã«é…ç½®
        // ã“ã‚Œã«ã‚ˆã‚Šã€æ‚ªåŒ–(å·¦ç§»å‹•)æ™‚ã¯ç›¤é¢ãŒæ™‚è¨ˆå›ã‚Šã€æ”¹å–„(å³ç§»å‹•)æ™‚ã¯ç›¤é¢ãŒåæ™‚è¨ˆå›ã‚Šã«å›ã‚‹
        const MENTAL_STATES = [
            { id: 'turnover', label: 'é€€è·ãƒ»è»¢å‡º', subLabel: '(å³æ­»)', colorBg: '#C4B5FD', colorBorder: '#A78BFA' }, // æœ€æ‚ª
            { id: 'apathy', label: 'ç„¡é–¢å¿ƒ', subLabel: '(å±é™ºåŸŸ)', colorBg: '#93C5FD', colorBorder: '#60A5FA' },
            { id: 'quiet_quit', label: 'é™ã‹ãªé€€è·', subLabel: '(å±é™ºåŸŸ)', colorBg: '#A5F3FC', colorBorder: '#67E8F9' },
            { id: 'resignation', label: 'è«¦ã‚ãƒ»é©å¿œ', subLabel: '', colorBg: '#BBF7D0', colorBorder: '#86EFAC' },
            { id: 'conflict', label: 'è‘›è—¤ãƒ»æŠµæŠ—', subLabel: '(æ€’ã‚Šã¨å¯¾ç«‹)', colorBg: '#FDE047', colorBorder: '#EAB308' },
            { id: 'waver', label: 'æºã‚‰ããƒ»è¿·ã„', subLabel: '', colorBg: '#E7CBA9', colorBorder: '#D4A373' },
            { id: 'growth', label: 'å……å®Ÿãƒ»æˆé•·', subLabel: '(ç†æƒ³)', colorBg: '#DCA598', colorBorder: '#B97A6D' }, // æœ€é«˜
        ];

        // é€±ã”ã¨ã®ç’°å¢ƒçŠ¶æ³
        const WEEKLY_SITUATIONS = [
            { text: "æ±ºç®—å‰ã®ç¹å¿™æœŸã§ã€ã‚ªãƒ•ã‚£ã‚¹å…¨ä½“ãŒãƒ”ãƒªãƒ”ãƒªã—ã¦ã„ã‚‹ã€‚", type: "busy" },
            { text: "æ¥­ç•Œæœ€å¤§æ‰‹ã®ä¸ç¥¥äº‹ãŒãƒ‹ãƒ¥ãƒ¼ã‚¹ã«ãªã‚Šã€é¡§å®¢å¯¾å¿œã«è¿½ã‚ã‚Œã¦ã„ã‚‹ã€‚", type: "trouble" },
            { text: "é–‘æ•£æœŸã«å…¥ã‚Šã€ç©ã‚„ã‹ãªç©ºæ°—ãŒæµã‚Œã¦ã„ã‚‹ã€‚", type: "calm" },
            { text: "æ–°å•†å“ãŒå¤§ãƒ’ãƒƒãƒˆã—ã€ç¤¾å†…ã¯ãŠç¥­ã‚Šé¨’ãã ã€‚", type: "good" },
            { text: "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ãŒæµè¡Œã—ã¦ãŠã‚Šã€ç©ºå¸­ãŒç›®ç«‹ã¤ã€‚", type: "bad" },
            { text: "å¤§å‹é€£ä¼‘ã‚’æ§ãˆã€ã©ã“ã‹æµ®è¶³ç«‹ã£ãŸé›°å›²æ°—ã ã€‚", type: "calm" },
            { text: "ç«¶åˆä»–ç¤¾ãŒæ–°ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç™ºè¡¨ã—ã€ç·Šæ€¥ä¼šè­°ãŒç¶šã„ã¦ã„ã‚‹ã€‚", type: "busy" },
            { text: "ä¸»è¦å–å¼•å…ˆã¨ã®å¥‘ç´„æ›´æ–°ãŒç„¡äº‹ã«å®Œäº†ã—ã€å®‰å µæ„ŸãŒåºƒãŒã£ã¦ã„ã‚‹ã€‚", type: "good" },
            { text: "ã‚·ã‚¹ãƒ†ãƒ ã®å¤§å‹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆä½œæ¥­ã§ã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ä»¥å¤–ã‚‚å¾…æ©ŸãŒç¶šãã€‚", type: "busy" },
            { text: "æ˜¥ã®é™½æ°—ã§ã€çª“ã®å¤–ã‚’çœºã‚ã‚‹ç¤¾å“¡ãŒå¤šã„ã€‚", type: "calm" },
            { text: "ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®é€šé”ãŒã‚ã‚Šã€å‚™å“ã®ä½¿ç”¨ã«ã‚‚åˆ¶é™ãŒã‹ã‹ã£ãŸã€‚", type: "bad" },
            { text: "ãƒœãƒ¼ãƒŠã‚¹æ”¯çµ¦æ—¥ãŒè¿‘ãã€çš†ã®è¡¨æƒ…ãŒæ˜ã‚‹ã„ã€‚", type: "good" }
        ];

        const generateInitialStats = () => ({
            inst_fairness: Math.floor(30 + Math.random() * 40),
            inter_fairness: Math.floor(30 + Math.random() * 40),
            autonomy: Math.floor(30 + Math.random() * 40),
            competence: Math.floor(30 + Math.random() * 40),
            psych_load: Math.floor(20 + Math.random() * 30),
            phys_energy: Math.floor(60 + Math.random() * 40)
        });

        const ActionType = {
            WORK: 'work',
            COMMUNICATION: 'comm',
            REST: 'rest',
            WAIT: 'wait'
        };

        const pickMsg = (messages) => messages[Math.floor(Math.random() * messages.length)];

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©
        const ACTIONS = [
            {
                id: 'praise',
                label: 'æˆæœã‚’è¤’ã‚ã‚‹',
                type: ActionType.COMMUNICATION,
                desc: 'å…·ä½“çš„ãªæˆæœã‚’æ‰¿èªã™ã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.2) {
                        return { 
                            diff: { inst_fairness: -5, inter_fairness: -10, competence: -5, psych_load: +20, phys_energy: 0 },
                            result: 'bad'
                        };
                    }
                    return { 
                        diff: { inst_fairness: +5, inter_fairness: +15, autonomy: 0, competence: +20, psych_load: -10, phys_energy: 0 },
                        result: 'good'
                    };
                },
                getMessages: (result) => result === 'good' ? [
                    "ã€Œã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ãã“ã€ã“ã ã‚ã£ãŸã‚“ã§ã™ï¼ã€éƒ¨ä¸‹ã¯å¬‰ã—ãã†ã«é ­ã‚’ã‹ã„ãŸã€‚",
                    "ã€Œéƒ¨é•·ã«ãã†è¨€ã£ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã€è‡ªä¿¡ã«ãªã‚Šã¾ã™ï¼ã€å£°è‰²ãŒæ˜ã‚‹ããªã£ãŸã€‚",
                    "ã€Œã‚„ã£ãŸï¼æ¬¡ã¯ã‚‚ã£ã¨ã„ã„ã‚‚ã®ä½œã‚Šã¾ã™ã­ï¼ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒçˆ†ä¸ŠãŒã‚Šã—ãŸã‚ˆã†ã ã€‚"
                ] : [
                    "ã€Œã‚ã€ã¯ã„...ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã§ã™ã­...ã€ã‹ãˆã£ã¦ç·Šå¼µã•ã›ã¦ã—ã¾ã£ãŸã€‚",
                    "ã€ŒãŠä¸–è¾ã¯ã„ã„ã§ã™ã‚ˆ...ã€å¿ƒã«å£ã‚’ä½œã‚‰ã‚Œã¦ã—ã¾ã£ãŸã‚ˆã†ã ã€‚",
                    "ã€Œçµæœã—ã‹è¦‹ã¦ãªã„ã‚“ã§ã™ã­...ã€ãƒ—ãƒ­ã‚»ã‚¹ã®è‹¦åŠ´ã‚’ç„¡è¦–ã•ã‚ŒãŸã¨æ„Ÿã˜ãŸã‚ˆã†ã ã€‚"
                ]
            },
            {
                id: 'scold',
                label: 'å³ã—ãæŒ‡å°',
                type: ActionType.WORK,
                desc: 'æ”¹å–„ç‚¹ã‚’æŒ‡æ‘˜ã—ä¿®æ­£ã•ã›ã‚‹',
                effect: (stats) => {
                    const successRate = stats.inter_fairness > 60 ? 0.7 : 0.3;
                    if (Math.random() < successRate) {
                        return {
                            diff: { inst_fairness: +15, inter_fairness: 0, autonomy: -5, competence: +15, psych_load: +20, phys_energy: -10 },
                            result: 'good'
                        };
                    } else {
                        return {
                            diff: { inst_fairness: 0, inter_fairness: -30, autonomy: -10, competence: -20, psych_load: +40, phys_energy: -20 },
                            result: 'bad'
                        };
                    }
                },
                getMessages: (result) => result === 'good' ? [
                    "ã€Œç¢ºã‹ã«ãã†ã§ã™ã­...ã€‚æ¬¡ã‹ã‚‰ã¯çµ¶å¯¾ã«æ°—ã‚’ã¤ã‘ã¾ã™ï¼ã€çœŸå‰£ãªçœ¼å·®ã—ã§ãƒ¡ãƒ¢ã‚’å–ã£ã¦ã„ã‚‹ã€‚",
                    "ã€Œã”æŒ‡æ‘˜ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã™ãã«ä¿®æ­£ã—ã¾ã™ï¼ã€",
                    "ã€Œã†ã£...ç—›ã„ã¨ã“ã‚ã‚’...ã€‚ã§ã‚‚ã€ãŠã£ã—ã‚ƒã‚‹é€šã‚Šã§ã™ã€‚ã€æˆé•·ã®ç³§ã¨ã—ã¦å—ã‘æ­¢ã‚ãŸã‚ˆã†ã ã€‚"
                ] : [
                    "ã€Œã™ã„ã¾ã›ã‚“...ï¼ˆãªã‚“ã§è‡ªåˆ†ã°ã£ã‹ã‚Š...ï¼‰ã€éƒ¨ä¸‹ã¯å”‡ã‚’å™›ã¿ç· ã‚ã€æ·±ãå‚·ã¤ã„ãŸã‚ˆã†ã ã€‚",
                    "ã€Œ...ã¯ã„ã€ã‚ã‹ã‚Šã¾ã—ãŸã€‚ã€ç´å¾—ã„ã‹ãªã„è¡¨æƒ…ã§ã€å°ã•ãªãŸã‚æ¯ãŒèã“ãˆãŸã€‚",
                    "ã€Œï¼ˆã¾ãŸæ€’ã‚‰ã‚ŒãŸ...ã‚‚ã†å«Œã ãª...ï¼‰ã€å®Œå…¨ã«å§”ç¸®ã—ã€ã‚„ã‚‹æ°—ã‚’å¤±ã‚ã›ã¦ã—ã¾ã£ãŸã€‚"
                ]
            },
            {
                id: 'delegate',
                label: 'ä»•äº‹ã‚’ä»»ã›ã‚‹',
                type: ActionType.WORK,
                desc: 'æ¨©é™å§”è­²ã—ã¦è¦‹å®ˆã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.3) {
                        return {
                            diff: { inst_fairness: -10, inter_fairness: -10, autonomy: +5, competence: -10, psych_load: +30, phys_energy: -20 },
                            result: 'bad'
                        };
                    }
                    return {
                        diff: { inst_fairness: 0, inter_fairness: +5, autonomy: +25, competence: +15, psych_load: +15, phys_energy: -15 },
                        result: 'good'
                    };
                },
                getMessages: (result) => result === 'good' ? [
                    "ã€Œã“ã‚Œã€åƒ•ãŒã‚„ã£ã¦ã„ã„ã‚“ã§ã™ã‹ï¼Ÿ ã‚„ã‚Šã¾ã™ï¼ã€ç›®ã‚’è¼ã‹ã›ã¦è³‡æ–™ã‚’å—ã‘å–ã£ãŸã€‚",
                    "ã€Œè²¬ä»»é‡å¤§ã§ã™ã­...ã§ã‚‚ã€ãƒãƒ£ãƒ³ã‚¹ã ã¨æ€ã£ã¦é ‘å¼µã‚Šã¾ã™ï¼ã€æ„æ°—ã«æ„Ÿã˜ã¦ã„ã‚‹ã€‚",
                    "ã€Œä»»ã›ã¦ãã ã•ã„ï¼æœŸå¾…ä»¥ä¸Šã®çµæœã‚’å‡ºã—ã¦ã¿ã›ã¾ã™ã‚ˆã€‚ã€"
                ] : [
                    "ã€Œãˆã€ã“ã‚Œåƒ•ãŒã‚„ã‚‹ã‚“ã§ã™ã‹...ï¼Ÿã€æ˜ã‚‰ã‹ã«å›°æƒ‘ã—ã¦ã„ã‚‹ã€‚",
                    "ã€Œä¸¸æŠ•ã’ã§ã™ã‹...ã‚ã‹ã‚Šã¾ã—ãŸ...ã€ä¸æº€ã’ã«è³‡æ–™ã‚’å—ã‘å–ã£ãŸã€‚",
                    "ã€Œä»Šã®æ¥­å‹™é‡ã§ã“ã‚Œä»¥ä¸Šã¯...ã€ã‚­ãƒ£ãƒ‘ã‚ªãƒ¼ãƒãƒ¼ã‚’èµ·ã“ã—ãã†ã ã€‚"
                ]
            },
            {
                id: 'micro_manage',
                label: 'ç´°ã‹ãæŒ‡ç¤ºå‡ºã—',
                type: ActionType.WORK,
                desc: 'é€²æ—ã‚’ç´°éƒ¨ã¾ã§ç®¡ç†ã™ã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.2) {
                        return {
                            diff: { inst_fairness: +10, inter_fairness: +10, autonomy: -10, competence: 0, psych_load: -10, phys_energy: -5 },
                            result: 'good'
                        };
                    }
                    return {
                        diff: { inst_fairness: +10, inter_fairness: -5, autonomy: -30, competence: -10, psych_load: +10, phys_energy: -10 },
                        result: 'bad' 
                    };
                },
                getMessages: (result) => result === 'good' ? [
                    "ã€Œç´°ã‹ãè¦‹ã¦ã‚‚ã‚‰ãˆã¦åŠ©ã‹ã‚Šã¾ã™ï¼è¿·ã‚ãšã«é€²ã‚ãã†ã§ã™ã€‚ã€æ„å¤–ã«ã‚‚æ„Ÿè¬ã•ã‚ŒãŸã€‚",
                    "ã€Œä¸€äººã ã¨ä¸å®‰ã ã£ãŸã®ã§ã€æŒ‡ç¤ºãŒã‚ã£ã¦å®‰å¿ƒã—ã¾ã—ãŸã€‚ã€"
                ] : [
                    "ã€Œã‚ã€ã¯ã„ã€‚ãã®é€šã‚Šã«é€²ã‚ã¾ã™...ã€éƒ¨ä¸‹ã®è¡¨æƒ…ã‹ã‚‰ç”Ÿæ°—ãŒæ¶ˆãˆãŸã€‚",
                    "ã€Œå ±å‘Šã§ã™ã­ã€‚ãˆãˆã¨ã€ä»Šã¯...ã€ç›£è¦–ã•ã‚Œã¦ã„ã‚‹ã¨æ„Ÿã˜ã€ç–²å¼Šã—ã¦ã„ã‚‹ã€‚",
                    "ã€Œç´°éƒ¨ã¾ã§ç¢ºèªã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™...ã€çš®è‚‰ã‚ã„ãŸéŸ¿ããŒæ··ã˜ã£ã¦ã„ã‚‹ã€‚"
                ]
            },
            {
                id: 'listen',
                label: '1on1ã§å‚¾è´',
                type: ActionType.COMMUNICATION,
                desc: 'ä¸æº€ã‚„ã‚­ãƒ£ãƒªã‚¢ã®ç›¸è«‡ã«ä¹—ã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.1) {
                        return {
                            diff: { inst_fairness: -15, inter_fairness: -5, autonomy: 0, competence: 0, psych_load: +5, phys_energy: 0 },
                            result: 'bad'
                        };
                    }
                    return {
                        diff: { inst_fairness: +5, inter_fairness: +25, autonomy: +5, competence: +5, psych_load: -20, phys_energy: 0 },
                        result: 'good'
                    };
                },
                getMessages: (result) => result === 'good' ? [
                    "ã€Œå®Ÿã¯æœ€è¿‘ã€å°‘ã—æ‚©ã‚“ã§ã„ã¦...ã€éƒ¨ä¸‹ã¯å °ã‚’åˆ‡ã£ãŸã‚ˆã†ã«è©±ã—å§‹ã‚ãŸã€‚",
                    "ã€Œéƒ¨é•·ã¨ã“ã†ã—ã¦è©±ã›ã‚‹ã¨ã€é ­ã®ä¸­ãŒæ•´ç†ã§ãã¾ã™ã€‚ã€è¡¨æƒ…ãŒæ™´ã‚Œã‚„ã‹ã«ãªã£ãŸã€‚",
                    "ã€Œã‚ãƒ¼ã€ã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸï¼ èã„ã¦ã‚‚ã‚‰ãˆã¦ã‚ˆã‹ã£ãŸã§ã™ã€‚ã€ä¿¡é ¼é–¢ä¿‚ãŒæ·±ã¾ã£ãŸã€‚"
                ] : [
                    "ã€Œèãã ã‘ãªã‚‰èª°ã§ã‚‚ã§ãã¾ã™ã‚ˆã­...ã€å…·ä½“çš„ãªè§£æ±ºç­–ãŒãªã„ã“ã¨ã«å¤±æœ›ã•ã‚ŒãŸã‚ˆã†ã ã€‚",
                    "ã€Œè©±ã—ã¦ã‚‚ç„¡é§„ã§ã—ãŸã­...ã€ã‹ãˆã£ã¦ä¸ä¿¡æ„Ÿã‚’æ‹›ã„ã¦ã—ã¾ã£ãŸã€‚"
                ]
            },
            {
                id: 'rest',
                label: 'ä¼‘æ¯ã‚’ä¿ƒã™',
                type: ActionType.REST,
                desc: 'æ—©å¸°ã‚Šã‚’æ¨å¥¨ã™ã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.2) {
                        return {
                            diff: { inst_fairness: 0, inter_fairness: -5, autonomy: -10, competence: 0, psych_load: +15, phys_energy: +5 },
                            result: 'bad'
                        };
                    }
                    return {
                        diff: { inst_fairness: 0, inter_fairness: +10, autonomy: 0, competence: 0, psych_load: -20, phys_energy: +30 },
                        result: 'good'
                    };
                },
                getMessages: (result) => result === 'good' ? [
                    "ã€Œãˆã€ã„ã„ã‚“ã§ã™ã‹ï¼Ÿ ã˜ã‚ƒã‚ã€ãŠè¨€è‘‰ã«ç”˜ãˆã¦...ã€éƒ¨ä¸‹ã¯å®‰å µã®è¡¨æƒ…ã§å¸°å®…ã—ãŸã€‚",
                    "ã€ŒåŠ©ã‹ã‚Šã¾ã™...æœ€è¿‘ã¡ã‚‡ã£ã¨å¯ä¸è¶³æ°—å‘³ã ã£ãŸã®ã§ã€‚ã€ä½“åŠ›ãŒå¤§å¹…ã«å›å¾©ã—ãŸã‚ˆã†ã ã€‚",
                    "ã€Œã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦ãã¾ã™ï¼ã€"
                ] : [
                    "ã€Œä»Šå¸°ã‚Œã£ã¦è¨€ã‚ã‚Œã¦ã‚‚ã€æ˜æ—¥å›°ã‚‹ã ã‘ãªã‚“ã§ã™ã‘ã©...ã€ä»•äº‹ã‚’æ®‹ã—ã¦å¸°ã‚‹ã“ã¨ã«ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ã¦ã„ã‚‹ã€‚",
                    "ã€Œã¯ã‚...ã‚ã‹ã‚Šã¾ã—ãŸï¼ˆå®¶ã§ã‚„ã‚ã†...ï¼‰ã€çµå±€æŒã¡å¸°ã£ã¦ä»•äº‹ã‚’ã™ã‚‹ã‚ˆã†ã ã€‚"
                ]
            },
            {
                id: 'drink',
                label: 'é£²ã¿ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³',
                type: ActionType.REST,
                desc: 'è…¹ã‚’å‰²ã£ã¦è©±ã™',
                effect: (stats) => {
                    if (Math.random() < 0.5) {
                        return {
                            diff: { inst_fairness: 0, inter_fairness: -15, autonomy: 0, competence: 0, psych_load: +15, phys_energy: -20 },
                            result: 'bad'
                        };
                    }
                    return {
                        diff: { inst_fairness: 0, inter_fairness: +30, autonomy: 0, competence: +10, psych_load: -15, phys_energy: -10 },
                        result: 'good'
                    };
                },
                getMessages: (result) => result === 'good' ? [
                    "ã€Œã„ã‚„ãƒ¼ã€éƒ¨é•·ãŒãã‚“ãªéå»ã‚’æŒã£ã¦ãŸã¨ã¯ï¼é¢ç™½ã„ã§ã™ï¼ã€é…’ã®å¸­ã§æ„æ°—æŠ•åˆã—ãŸã€‚",
                    "ã€Œã¶ã£ã¡ã‚ƒã‘ã¾ã™ã‘ã©...éƒ¨é•·ã®ã“ã¨ã€æœ€åˆã¯æ€–ã‹ã£ãŸã‚“ã§ã™ã‚ˆï¼ˆç¬‘ï¼‰ã€æœ¬éŸ³ã§èªã‚ŠåˆãˆãŸã€‚",
                    "æœ€é«˜ã«ç››ã‚Šä¸ŠãŒã‚Šã€å›ºã„æ¡æ‰‹ã‚’äº¤ã‚ã—ã¦åˆ¥ã‚ŒãŸã€‚"
                ] : [
                    "ã€Œã‚ã€æ˜æ—¥æ—©ã„ã‚“ã§ã€ãã‚ãã‚...ã€éƒ¨ä¸‹ã¯æ™‚è¨ˆã‚’ãƒãƒ©ãƒãƒ©è¦‹ã¦ã„ã‚‹ã€‚",
                    "ã€Œã¯ã¯...ãã†ã§ã™ã­...ã€æ„›æƒ³ç¬‘ã„ã®é€£ç¶šã§ã€æ°—ã¾ãšã„ç©ºæ°—ãŒæµã‚ŒãŸã€‚",
                    "ã€Œã™ã„ã¾ã›ã‚“ã€ã¡ã‚‡ã£ã¨é…”ã„ãŒå›ã£ã¡ã‚ƒã£ã¦...ã€éƒ¨ä¸‹ã‚’ç–²å¼Šã•ã›ã¦ã—ã¾ã£ãŸã ã‘ã ã£ãŸã€‚"
                ]
            },
            {
                id: 'wait',
                label: 'ãã£ã¨ã—ã¦ãŠã',
                type: ActionType.WAIT,
                desc: 'ä½•ã‚‚ã›ãšæ§˜å­ã‚’è¦‹ã‚‹',
                effect: (stats) => {
                    const rand = Math.random();
                    if (rand < 0.3) {
                        return {
                            diff: { inst_fairness: 0, inter_fairness: 0, autonomy: +10, competence: +5, psych_load: -10, phys_energy: +10 },
                            result: 'good'
                        };
                    } else if (rand < 0.6) {
                        return {
                            diff: { inst_fairness: -5, inter_fairness: -10, autonomy: 0, competence: -5, psych_load: +10, phys_energy: 0 },
                            result: 'bad'
                        };
                    } else {
                        return {
                            diff: { inst_fairness: 0, inter_fairness: 0, autonomy: 0, competence: 0, psych_load: 0, phys_energy: 0 },
                            result: 'none'
                        };
                    }
                },
                getMessages: (result) => {
                    if (result === 'good') return [
                        "éƒ¨ä¸‹ã¯è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§ä»•äº‹ã‚’é€²ã‚ã€èª¿å­ã‚’å–ã‚Šæˆ»ã—ãŸã‚ˆã†ã ã€‚",
                        "ä½™è¨ˆãªå¹²æ¸‰ã‚’ã—ãªã‹ã£ãŸã“ã¨ã§ã€éƒ¨ä¸‹ã¯ã®ã³ã®ã³ã¨ã—ã¦ã„ã‚‹ã€‚",
                        "å°‘ã—ä¼‘æ†©ã—ã¦ã„ãŸã‚ˆã†ã ãŒã€ãã®å¾Œé›†ä¸­ã—ã¦ã‚¿ã‚¹ã‚¯ã‚’ç‰‡ä»˜ã‘ãŸã€‚"
                    ];
                    if (result === 'bad') return [
                        "éƒ¨ä¸‹ã¯æ‰‹æŒã¡ç„¡æ²™æ±°ã«ã—ã¦ã„ã‚‹...ã€Œæ”¾ç½®ã•ã‚Œã¦ã„ã‚‹ã€ã¨æ„Ÿã˜ãŸã‚ˆã†ã ã€‚",
                        "å›°ã£ã¦ã„ã‚‹ã‚ˆã†ã ãŒã€å£°ã‚’ã‹ã‘ãªã‹ã£ãŸãŸã‚ãƒŸã‚¹ãŒç™ºç”Ÿã—ã¦ã—ã¾ã£ãŸã€‚",
                        "èª°ã¨ã‚‚ä¼šè©±ã›ãšä¸€æ—¥ãŒçµ‚ã‚ã‚Šã€éƒ¨ä¸‹ã¯å­¤ç‹¬ã‚’æ„Ÿã˜ã¦ã„ã‚‹ã€‚"
                    ];
                    return [
                        "ç‰¹ã«å¤‰ã‚ã£ãŸæ§˜å­ã¯ãªã„ã€‚æ·¡ã€…ã¨æ™‚é–“ãŒéããŸã€‚",
                        "éƒ¨ä¸‹ã¯é»™ã€…ã¨ä½œæ¥­ã‚’ã—ã¦ã„ã‚‹ã€‚è‰¯ãã‚‚æ‚ªãã‚‚å¤‰åŒ–ã¯ãªã„ã€‚",
                        "çª“ã®å¤–ã‚’çœºã‚ã¦ã„ã‚‹...ä½•ã‚’è€ƒãˆã¦ã„ã‚‹ã®ã ã‚ã†ã‹ã€‚"
                    ];
                }
            }
        ];

        const RANDOM_EVENTS = [
            { title: "ä¸é€æ˜ãªäººäº‹ç•°å‹•", desc: "ã€Œãªã‚“ã§ã‚ã®äººãŒæ˜‡é€²ã™ã‚‹ã‚“ã§ã™ã‹...ï¼Ÿã€éƒ¨ä¸‹ãŒä¸ä¿¡æ„Ÿã‚’æŠ±ã„ã¦ã„ã‚‹ã€‚", effect: { inst_fairness: -15, inter_fairness: 0, autonomy: 0, competence: 0, psych_load: +5, phys_energy: 0 } },
            { title: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¤§æˆåŠŸ", desc: "ã€Œã‚„ã‚Šã¾ã—ãŸã­éƒ¨é•·ï¼ç§ãŸã¡æœ€é«˜ã˜ã‚ƒãªã„ã§ã™ã‹ï¼ï¼Ÿã€", effect: { inst_fairness: +5, inter_fairness: 0, autonomy: 0, competence: +15, psych_load: -5, phys_energy: -5 } },
            { title: "ç¹å¿™æœŸçªå…¥", desc: "ã€Œçµ‚ã‚ã‚‰ãªã„...å…¨ç„¶ä»•äº‹ãŒçµ‚ã‚ã‚‰ãªã„ã§ã™ã‚ˆ...ã€", effect: { inst_fairness: 0, inter_fairness: 0, autonomy: -5, competence: 0, psych_load: +10, phys_energy: -15 } },
            { title: "ç†ä¸å°½ãªã‚¯ãƒ¬ãƒ¼ãƒ ", desc: "ã€Œç§ã€ä½•ã‚‚æ‚ªããªã„ã®ã«...ã‚‚ã†ç–²ã‚Œã¾ã—ãŸ...ã€", effect: { inst_fairness: 0, inter_fairness: 0, autonomy: -5, competence: -5, psych_load: +15, phys_energy: -10 } },
            { title: "æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã®å°å…¥", desc: "ã€Œã“ã‚Œå‡„ã„ï¼é¢å€’ãªä½œæ¥­ãŒä¸€ç¬ã§çµ‚ã‚ã‚Šã¾ã™ï¼ã€", effect: { inst_fairness: +5, inter_fairness: 0, autonomy: +5, competence: +5, psych_load: -5, phys_energy: +5 } }
        ];

        function SubordinateSurvival() {
            const [gameState, setGameState] = useState('start'); 
            const [week, setWeek] = useState(1);
            const [stats, setStats] = useState(generateInitialStats());
            const [parameterChanges, setParameterChanges] = useState({});
            const [lastMessage, setLastMessage] = useState("");
            const [eventMessage, setEventMessage] = useState(null);
            const [history, setHistory] = useState([]);
            const [currentActions, setCurrentActions] = useState([]);
            const [gameOverReason, setGameOverReason] = useState("");
            const [currentSituation, setCurrentSituation] = useState(WEEKLY_SITUATIONS[0]);
            const [score, setScore] = useState(0); 
            const logsEndRef = useRef(null);

            useEffect(() => {
                logsEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [history]);

            // çŠ¶æ…‹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ0åˆ¤å®šã‚’è¿½åŠ ï¼‰
            const determineMentalStateId = (s) => {
                // 1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¯æ¸‡ã«ã‚ˆã‚‹å¼·åˆ¶é€€è·ï¼ˆ0ã«ãªã£ãŸã‚‰å³æ­»ï¼‰
                if (s.inst_fairness <= 0 || s.inter_fairness <= 0 || s.autonomy <= 0 || s.competence <= 0 || s.phys_energy <= 0) return 'turnover';

                // 2. é€šå¸¸ã®åˆ¤å®š
                if (s.psych_load > 85 || s.phys_energy < 15) return 'turnover'; 
                
                if (s.inst_fairness < 40 && s.inter_fairness < 40 && s.phys_energy > 40) return 'conflict';
                if (s.autonomy < 40 && s.psych_load < 60) return 'resignation'; 
                if (s.competence < 40 && s.autonomy < 40) return 'quiet_quit'; 
                if (s.phys_energy < 40 && s.competence < 40) return 'apathy'; 
                
                if (s.autonomy > 60 && s.competence > 60 && s.phys_energy > 50 && s.inst_fairness > 50) return 'growth'; 
                
                return 'waver'; 
            };

            const updateWeeklySituation = () => {
                const situation = WEEKLY_SITUATIONS[Math.floor(Math.random() * WEEKLY_SITUATIONS.length)];
                setCurrentSituation(situation);
                return situation;
            };

            const startGame = () => {
                setStats(generateInitialStats()); 
                setParameterChanges({});
                setWeek(1);
                setGameState('playing');
                setLastMessage("ã€Œä»ŠæœŸã‚‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€éƒ¨é•·ï¼ã€");
                setEventMessage(null);
                setHistory([]);
                updateWeeklySituation();
                pickRandomActions();
            };

            const pickRandomActions = () => {
                const shuffled = [...ACTIONS].sort(() => 0.5 - Math.random());
                setCurrentActions(shuffled.slice(0, 3));
            };

            const handleAction = (action) => {
                const { diff: changes, result } = action.effect(stats);
                let newStats = { ...stats };
                
                Object.keys(changes).forEach(key => {
                    newStats[key] += changes[key];
                });

                setParameterChanges(changes);

                const possibleMessages = action.getMessages(result);
                const actionMsg = pickMsg(possibleMessages);
                
                setLastMessage(actionMsg);
                
                let historyColor = 'text-gray-700';
                if (result === 'good') historyColor = 'text-green-700 font-bold';
                if (result === 'bad') historyColor = 'text-red-700 font-bold';

                const newHistory = [...history, { 
                    week, 
                    type: 'action', 
                    text: `${action.label} â†’ ${actionMsg}`,
                    className: historyColor
                }];

                let evtMsg = null;
                if (Math.random() < 0.25 && week < MAX_WEEKS) {
                    const evt = RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)];
                    Object.keys(evt.effect).forEach(key => {
                        newStats[key] += evt.effect[key];
                    });
                    evtMsg = evt;
                    newHistory.push({ week, type: 'event', text: `âš¡ ${evt.desc}` });
                }
                setEventMessage(evtMsg);
                setHistory(newHistory);

                Object.keys(newStats).forEach(key => {
                    newStats[key] = Math.max(0, Math.min(100, newStats[key]));
                });

                setStats(newStats);
                checkGameState(newStats, week);
            };

            const checkGameState = (currentStats, currentWeek) => {
                const currentState = determineMentalStateId(currentStats);
                
                // 1. å³æ­»åˆ¤å®š (Turnoverã«ãªã£ãŸç¬é–“)
                if (currentState === 'turnover') {
                    finishGame('turnover', currentStats);
                    return;
                }

                // 2. æœŸé–“çµ‚äº†åˆ¤å®š
                if (currentWeek >= MAX_WEEKS) {
                    // çµ‚äº†æ™‚ã«ã€Œé™ã‹ãªé€€è·ã€ã€Œç„¡é–¢å¿ƒã€ã€Œé€€è·ãƒ»è»¢å‡ºã€ã®å ´åˆã¯æ•—åŒ—
                    if (['quiet_quit', 'apathy', 'turnover'].includes(currentState)) {
                        finishGame('quiet_quit_end', currentStats);
                    } else {
                        finishGame('victory', currentStats);
                    }
                } else {
                    setWeek(prev => prev + 1);
                    updateWeeklySituation(); 
                    pickRandomActions();
                }
            };

            const finishGame = (reason, finalStats) => {
                let reasonText = "";
                let calculatedScore = 0;

                if (reason === 'victory') {
                    const total = 
                        finalStats.inst_fairness + 
                        finalStats.inter_fairness + 
                        finalStats.autonomy + 
                        finalStats.competence + 
                        (100 - finalStats.psych_load) + 
                        finalStats.phys_energy;
                    calculatedScore = Math.floor(total / 6);
                } else {
                    calculatedScore = 0; // ãã‚Œä»¥å¤–ã¯0ç‚¹
                }

                switch(reason) {
                    case 'turnover': 
                        if(finalStats.inst_fairness <= 0 || finalStats.inter_fairness <= 0 || finalStats.autonomy <= 0 || finalStats.competence <= 0 || finalStats.phys_energy <= 0) {
                            reasonText = "é™ç•Œã‚’è¶…ãˆã¾ã—ãŸã€‚ä½•ã‹ãŒå®Œå…¨ã«æ¬ è½ã—ã€éƒ¨ä¸‹ã¯å»ã‚Šã¾ã—ãŸã€‚ï¼ˆåŸå› ï¼šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¯æ¸‡ï¼‰";
                        }
                        else if(finalStats.psych_load > 85) reasonText = "ã€Œã‚‚ã†ç„¡ç†ã§ã™...ä¼šç¤¾ã«æ¥ã‚‹ã®ãŒæ€–ãã¦...ã€ä¼‘è·é¡˜ãŒå‡ºã•ã‚Œã¾ã—ãŸã€‚ï¼ˆåŸå› ï¼šå¿ƒç†çš„è² è·ã®é™ç•Œï¼‰";
                        else if(finalStats.phys_energy < 15) reasonText = "æ·±å¤œã€éƒ¨ä¸‹ãŒã‚ªãƒ•ã‚£ã‚¹ã§å€’ã‚Œæ•‘æ€¥æ¬é€ã•ã‚Œã¾ã—ãŸã€‚ï¼ˆåŸå› ï¼šèº«ä½“çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æ¯æ¸‡ï¼‰";
                        else reasonText = "ã€Œã“ã®ä¼šç¤¾ã«ã¯æœªæ¥ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã€é€€è·å±ŠãŒå©ãã¤ã‘ã‚‰ã‚Œã¾ã—ãŸã€‚ï¼ˆåŸå› ï¼šå…¬å¹³æ€§ã®æ¬ å¦‚ï¼‰";
                        break;
                    case 'quiet_quit_end':
                        reasonText = "æœŸé–“æº€äº†ã§ã™ãŒã€éƒ¨ä¸‹ã¯å®Œå…¨ã«ã‚„ã‚‹æ°—ã‚’å¤±ã£ã¦ã„ã¾ã™ã€‚ã€Œè¨€ã‚ã‚ŒãŸã“ã¨ã ã‘ã‚„ã‚Šã¾ã™...ã€äº‹å®Ÿä¸Šã®ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæ•—åŒ—ã§ã™ã€‚ï¼ˆåŸå› ï¼šé™ã‹ãªé€€è·ãƒ»ç„¡é–¢å¿ƒï¼‰";
                        break;
                    case 'victory':
                        reasonText = "éƒ¨ä¸‹ã¯ç´ æ™´ã‚‰ã—ã„çŠ¶æ…‹ã§æœŸã‚’çµ‚ãˆã¾ã—ãŸã€‚ä¿¡é ¼é–¢ä¿‚ã¯ç›¤çŸ³ã§ã™ï¼";
                        break;
                    default: 
                        reasonText = "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼";
                }
                
                setScore(calculatedScore);
                setGameOverReason(reasonText);
                setGameState(reason === 'victory' ? 'victory' : 'gameover');
            };

            const currentMentalStateId = determineMentalStateId(stats);
            const currentStateIndex = MENTAL_STATES.findIndex(s => s.id === currentMentalStateId);
            const rotationAngle = -currentStateIndex * (360 / MENTAL_STATES.length); 

            // --- UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ---

            const ProgressBar = ({ label, value, change, color }) => (
                <div className="mb-2.5 w-full">
                    <div className="flex justify-between items-end text-xs text-white mb-0.5 px-0.5">
                        <span className="font-medium bg-slate-900/50 px-1 rounded">{label}</span>
                        <div className="flex gap-1 items-baseline">
                            {change !== 0 && change !== undefined && (
                                <span className={`text-[10px] ${change > 0 ? 'text-green-300' : 'text-red-300'}`}>
                                    {change > 0 ? 'â–²' : 'â–¼'}{Math.abs(change)}
                                </span>
                            )}
                            <span className="font-mono font-bold text-sm">{value}</span>
                        </div>
                    </div>
                    <div className="w-full bg-slate-700/50 h-2.5 rounded-sm overflow-hidden backdrop-blur-sm border border-slate-600/50">
                        <div 
                            className="h-full transition-all duration-500 rounded-sm" 
                            style={{ width: `${value}%`, backgroundColor: color }}
                        />
                    </div>
                </div>
            );

            return (
                <div className="w-full max-w-5xl h-full md:h-auto bg-white rounded-xl shadow-2xl overflow-hidden border border-slate-200 flex flex-col">
                    
                    {/* Header */}
                    <div className="bg-slate-800 text-white p-4 flex justify-between items-center shrink-0">
                        <h1 className="font-bold text-lg flex items-center gap-2">
                            <Briefcase size={20} />
                            çµ„ç¹”å¿ƒç†å­¦ã‚µãƒã‚¤ãƒãƒ«
                        </h1>
                        <div className="text-sm bg-slate-700 px-3 py-1 rounded-full font-mono">
                            Week {gameState === 'start' ? 1 : week} / {MAX_WEEKS}
                        </div>
                    </div>

                    {/* Start Screen */}
                    {gameState === 'start' && (
                        <div className="p-8 text-center flex-1 flex flex-col justify-center items-center">
                            <div className="mb-6 text-7xl">ğŸ¢</div>
                            <h2 className="text-3xl font-bold mb-4">ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆãƒ»ã‚µãƒã‚¤ãƒãƒ« <span className="text-red-500 text-sm block mt-1">Hard Mode</span></h2>
                            <p className="text-gray-600 mb-8 leading-relaxed text-base max-w-lg">
                                ã‚ãªãŸã¯ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¨ã—ã¦ã€éƒ¨ä¸‹ã®6ã¤ã®å¿ƒç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç®¡ç†ã—ã¾ã™ã€‚<br/>
                                <br/>
                                <strong>âš ï¸ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ¡ä»¶:</strong><br/>
                                1. ã„ãšã‚Œã‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ0ã«ãªã‚‹ã€ã¾ãŸã¯ã€Œé€€è·ãƒ»è»¢å‡ºã€çŠ¶æ…‹ã«ãªã‚‹<br/>
                                2. æœŸé–“çµ‚äº†æ™‚ã«ã€Œé™ã‹ãªé€€è·ã€ã¾ãŸã¯ã€Œç„¡é–¢å¿ƒã€çŠ¶æ…‹ã§ã‚ã‚‹ã“ã¨<br/>
                                <br/>
                                äº›ç´°ãªé¸æŠãŒå‘½å–ã‚Šã«ãªã‚Šã¾ã™ã€‚æ…é‡ã«ã€æ™‚ã«å¤§èƒ†ã«æŒ‡ç¤ºã‚’å‡ºã—ã¦ãã ã•ã„ã€‚
                            </p>
                            <button 
                                onClick={startGame}
                                className="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-lg text-lg transition-transform transform active:scale-95"
                            >
                                ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆé–‹å§‹ï¼ˆåˆæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç”Ÿæˆï¼‰
                            </button>
                        </div>
                    )}

                    {/* Main Game Screen */}
                    {gameState === 'playing' && (
                        <div className="flex flex-col md:flex-row h-full overflow-hidden">
                            
                            {/* å·¦ã‚«ãƒ©ãƒ : ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */}
                            <div className="flex-1 bg-slate-50/50 flex items-center justify-center p-6 relative overflow-hidden border-b md:border-b-0 md:border-r border-slate-200">
                                <div className="relative w-[400px] h-[400px] flex items-center justify-center">
                                    <div 
                                        className="absolute w-full h-full flex items-center justify-center transition-transform duration-1000 ease-in-out"
                                        style={{ transform: `rotate(${rotationAngle}deg)` }}
                                    >
                                        <div className="absolute w-[340px] h-[340px] rounded-full border-2 border-dashed border-slate-300"></div>
                                        {MENTAL_STATES.map((state, index) => {
                                            const angle = index * (360 / MENTAL_STATES.length);
                                            const radius = 170; 
                                            const isActive = state.id === currentMentalStateId;
                                            return (
                                                <div
                                                    key={state.id}
                                                    className="absolute flex flex-col items-center justify-center text-center transition-all duration-500"
                                                    style={{
                                                        top: '50%',
                                                        left: '50%',
                                                        marginTop: '-3rem',
                                                        marginLeft: '-3rem',
                                                        transform: `rotate(${angle}deg) translate(0, -${radius}px) rotate(${-angle}deg) rotate(${-rotationAngle}deg)` 
                                                    }}
                                                >
                                                    <div 
                                                        className={`w-24 h-24 rounded-full flex flex-col items-center justify-center shadow-lg border-2 transition-all duration-500 ${isActive ? 'scale-110 ring-4 ring-offset-2 ring-yellow-200 font-bold z-10' : 'bg-white/90 border-slate-300 opacity-60'}`}
                                                        style={{ 
                                                            backgroundColor: isActive ? state.colorBg : undefined,
                                                            borderColor: isActive ? state.colorBorder : undefined
                                                        }}
                                                    >
                                                        <span className="text-sm text-slate-800 leading-tight px-2">{state.label}</span>
                                                        {state.subLabel && <span className="text-[10px] text-slate-500 mt-1">{state.subLabel}</span>}
                                                    </div>
                                                    {isActive && (
                                                        <div className="absolute -bottom-8 bg-slate-800 text-white text-[10px] px-2 py-1 rounded shadow animate-bounce whitespace-nowrap z-20 hidden md:block">
                                                            ç¾åœ¨: {state.label}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <div className="absolute w-64 h-64 bg-slate-800 rounded-full flex flex-col justify-center px-8 shadow-2xl z-30 border-4 border-slate-600">
                                        <ProgressBar label="å…¬å¹³æ€§(åˆ¶åº¦)" value={stats.inst_fairness} change={parameterChanges.inst_fairness} color="#60A5FA" />
                                        <ProgressBar label="å…¬å¹³æ€§(å¯¾äºº)" value={stats.inter_fairness} change={parameterChanges.inter_fairness} color="#818CF8" />
                                        <ProgressBar label="è£é‡æ„Ÿ" value={stats.autonomy} change={parameterChanges.autonomy} color="#4ADE80" />
                                        <ProgressBar label="æœ‰ç”¨æ„Ÿ" value={stats.competence} change={parameterChanges.competence} color="#2DD4BF" />
                                        <ProgressBar label="å¿ƒç†çš„è² è·" value={stats.psych_load} change={parameterChanges.psych_load} color="#F472B6" />
                                        <ProgressBar label="èº«ä½“ã‚¨ãƒŠã‚¸ãƒ¼" value={stats.phys_energy} change={parameterChanges.phys_energy} color="#FB923C" />
                                    </div>
                                </div>
                            </div>

                            {/* å³ã‚«ãƒ©ãƒ : æ“ä½œã‚¨ãƒªã‚¢ */}
                            <div className="flex-1 flex flex-col min-w-0 bg-white z-20">
                                <div className="flex-1 overflow-y-auto p-6 flex flex-col justify-center">
                                    <div className="w-full mb-4">
                                        <div className="flex items-center gap-2 text-xs font-bold text-slate-400 mb-1 uppercase tracking-wider">
                                            <TrendingUp size={14} />
                                            ä»Šé€±ã®è·å ´ç’°å¢ƒ / æ¥­ç•Œãƒ‹ãƒ¥ãƒ¼ã‚¹
                                        </div>
                                        <div className={`p-3 rounded-lg border-l-4 text-sm font-medium ${
                                            currentSituation.type === 'busy' || currentSituation.type === 'trouble' || currentSituation.type === 'bad' 
                                            ? 'bg-red-50 border-red-400 text-red-800' 
                                            : currentSituation.type === 'good'
                                            ? 'bg-blue-50 border-blue-400 text-blue-800'
                                            : 'bg-gray-50 border-gray-400 text-gray-700'
                                        }`}>
                                            {currentSituation.text}
                                        </div>
                                    </div>

                                    <div className="w-full mb-6">
                                        <div className="bg-slate-100 px-6 py-4 rounded-xl text-base text-slate-700 w-full text-center border border-slate-200 min-h-[4rem] flex items-center justify-center shadow-inner italic relative">
                                            <span className="absolute top-2 left-2 text-3xl text-slate-200">"</span>
                                            {lastMessage}
                                            <span className="absolute bottom-2 right-2 text-3xl text-slate-200">"</span>
                                        </div>
                                        {eventMessage && (
                                            <div className="bg-yellow-50 px-4 py-3 mt-2 rounded-lg text-sm text-yellow-800 text-center border border-yellow-200 animate-pulse font-bold flex items-center justify-center gap-2">
                                                <Zap size={16} /> {eventMessage.title}: {eventMessage.desc}
                                            </div>
                                        )}
                                    </div>

                                    <div className="w-full space-y-3">
                                        <h3 className="text-sm font-bold text-gray-500 mb-2 flex items-center gap-2">
                                            <Briefcase size={16} />
                                            ä»Šé€±ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ©ãƒ³ãƒ€ãƒ é¸å‡ºï¼‰
                                        </h3>
                                        <div className="grid grid-cols-1 gap-3">
                                            {currentActions.map((action) => (
                                                <button
                                                    key={action.id}
                                                    onClick={() => handleAction(action)}
                                                    className="w-full text-left bg-white hover:bg-blue-50 border-2 border-slate-200 hover:border-blue-500 p-4 rounded-xl transition-all duration-200 group relative overflow-hidden shadow-sm active:scale-[0.99]"
                                                >
                                                    <div className="flex justify-between items-center relative z-10">
                                                        <div className="flex-1 min-w-0 pr-4">
                                                            <span className="font-bold text-slate-800 text-base block mb-1">{action.label}</span>
                                                            <span className="text-xs text-slate-500 block">{action.desc}</span>
                                                        </div>
                                                        <div className="bg-slate-50 text-slate-400 p-3 rounded-full group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors shrink-0">
                                                            {action.type === ActionType.COMMUNICATION && <MessageCircle size={20} />}
                                                            {action.type === ActionType.WORK && <Briefcase size={20} />}
                                                            {action.type === ActionType.REST && <Coffee size={20} />}
                                                            {action.type === ActionType.WAIT && <Eye size={20} />}
                                                        </div>
                                                    </div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="bg-slate-50 border-t border-slate-200 p-3 h-40 shrink-0">
                                    <h4 className="text-xs font-bold text-gray-500 mb-2 flex items-center gap-1">
                                        <History size={12} />
                                        æ´»å‹•å±¥æ­´
                                    </h4>
                                    <div className="h-full overflow-y-auto pb-6 text-xs space-y-2 pr-2 custom-scrollbar">
                                        {history.length === 0 ? (
                                            <p className="text-gray-400 italic text-center py-4">å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
                                        ) : (
                                            history.map((log, i) => (
                                                <div key={i} className={`p-2 rounded border ${log.type === 'event' ? 'bg-yellow-50 border-yellow-200 text-yellow-800' : 'bg-white border-slate-200'} ${log.className || 'text-gray-700'}`}>
                                                    <span className="font-mono font-bold text-gray-400 mr-2 border-r border-gray-200 pr-2">W{log.week}</span>
                                                    {log.text}
                                                </div>
                                            ))
                                        )}
                                        <div ref={logsEndRef} />
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Game Over / Victory Screen */}
                    {(gameState === 'gameover' || gameState === 'victory') && (
                        <div className={`p-12 text-center flex-1 flex flex-col justify-center items-center ${gameState === 'victory' ? 'bg-blue-50' : 'bg-red-50'}`}>
                            {gameState === 'victory' ? (
                                <>
                                    <Award size={80} className="mx-auto text-yellow-500 mb-6" />
                                    <h2 className="text-3xl font-bold text-blue-900 mb-2">QUARTER COMPLETE!</h2>
                                    <div className="text-5xl font-bold text-blue-600 mb-4">{score}<span className="text-2xl text-blue-400">ç‚¹</span></div>
                                    <p className="text-blue-700 mb-8 text-lg">{gameOverReason}</p>
                                </>
                            ) : (
                                <>
                                    {/* æ•—åŒ—æ™‚ã¯ã‚´ãƒ¼ã‚¹ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã‹UserMinusã‚’è¡¨ç¤º */}
                                    {gameOverReason.includes("é™ã‹ãªé€€è·") ? (
                                        <Ghost size={80} className="mx-auto text-gray-500 mb-6" />
                                    ) : (
                                        <UserMinus size={80} className="mx-auto text-red-500 mb-6" />
                                    )}
                                    <h2 className="text-3xl font-bold text-red-800 mb-2">GAME OVER</h2>
                                    <div className="text-5xl font-bold text-gray-400 mb-4">0<span className="text-2xl text-gray-300">ç‚¹</span></div>
                                    <div className="bg-white p-6 rounded-xl shadow-md border border-red-100 mb-10 text-left relative mt-4 max-w-lg w-full">
                                        <div className="absolute -top-3 left-6 bg-red-100 text-red-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">
                                            {gameOverReason.includes("é™ã‹ãªé€€è·") ? "ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆå¤±æ•—" : "é€€è·/ä¼‘è·å±Š"}
                                        </div>
                                        <p className="text-gray-700 font-serif italic text-lg leading-relaxed mt-2">"{gameOverReason}"</p>
                                    </div>
                                </>
                            )}
                            
                            <button 
                                onClick={startGame}
                                className={`px-8 py-4 text-white font-bold rounded-lg shadow-lg text-lg transition flex items-center gap-2 ${gameState === 'victory' ? 'bg-blue-600 hover:bg-blue-700' : 'bg-slate-800 hover:bg-slate-900'}`}
                            >
                                <RefreshCw size={20} />
                                {gameState === 'victory' ? 'æ¬¡ã®æœŸã¸' : 'å†æŒ‘æˆ¦ï¼ˆåˆæœŸå€¤ãƒ©ãƒ³ãƒ€ãƒ ï¼‰'}
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SubordinateSurvival />);
    </script>
</body>
</html>
