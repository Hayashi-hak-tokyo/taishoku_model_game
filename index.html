<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ„Ÿæƒ…ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ </title>
    <!-- Tailwind CSS (ãƒ‡ã‚¶ã‚¤ãƒ³ç”¨) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM (ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel (ã‚³ãƒ¼ãƒ‰å¤‰æ›ç”¨) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        body { font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <div id="root" class="w-full max-w-6xl h-[95vh]"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ---
        const IconBase = ({ children, color = "currentColor", size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );
        const Briefcase = (p) => <IconBase {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconBase>;
        const MessageCircle = (p) => <IconBase {...p}><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></IconBase>;
        const Coffee = (p) => <IconBase {...p}><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></IconBase>;
        const History = (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/><path d="M12 7v5l4 2"/></IconBase>;
        const UserMinus = (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="22" x2="16" y1="11" y2="11"/></IconBase>;
        const Award = (p) => <IconBase {...p}><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></IconBase>;
        const RefreshCw = (p) => <IconBase {...p}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const TrendingUp = (p) => <IconBase {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconBase>;
        const Zap = (p) => <IconBase {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>;
        const Eye = (p) => <IconBase {...p}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Ghost = (p) => <IconBase {...p}><path d="M9 10h.01"/><path d="M15 10h.01"/><path d="M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"/></IconBase>;
        const Copy = (p) => <IconBase {...p}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></IconBase>;
        const BarChart = (p) => <IconBase {...p}><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></IconBase>;

        // --- å®šæ•° ---
        const MAX_WEEKS = 12;
        const MENTAL_STATES = [
            { id: 'growth', label: 'å……å®Ÿãƒ»æˆé•·', subLabel: 'ç†æƒ³', colorBg: '#D46B55', colorBorder: '#B95846' },
            { id: 'waver', label: 'æºã‚‰ããƒ»è¿·ã„', subLabel: '', colorBg: '#E6CBA9', colorBorder: '#C9AF8D' },
            { id: 'conflict', label: 'è‘›è—¤ãƒ»æŠµæŠ—', subLabel: 'æ€’ã‚Šã¨å¯¾ç«‹', colorBg: '#F3E5AB', colorBorder: '#D6C890' },
            { id: 'resignation', label: 'è«¦ã‚ãƒ»é©å¿œ', subLabel: '', colorBg: '#BDDDB2', colorBorder: '#9FC194' },
            { id: 'quiet_quit', label: 'é™ã‹ãªé€€è·', subLabel: 'å±é™º', colorBg: '#B3DFD7', colorBorder: '#93BFB7' },
            { id: 'apathy', label: 'ç„¡é–¢å¿ƒ', subLabel: 'å±é™º', colorBg: '#9BBBE3', colorBorder: '#7E9EC6' },
            { id: 'turnover', label: 'é€€è·ãƒ»è»¢å‡º', subLabel: 'å³æ­»', colorBg: '#9B88D6', colorBorder: '#7D6AB8' },
        ];
        
        const PARAM_LABELS = {
            inst_fairness: "å…¬å¹³æ€§(åˆ¶åº¦)",
            inter_fairness: "å…¬å¹³æ€§(å¯¾äºº)",
            autonomy: "è£é‡æ„Ÿ",
            competence: "æœ‰ç”¨æ„Ÿ",
            psych_load: "å¿ƒç†çš„è² è·",
            phys_energy: "èº«ä½“ã‚¨ãƒŠã‚¸ãƒ¼"
        };

        const WEEKLY_SITUATIONS = [
            { text: "æ±ºç®—å‰ã®ç¹å¿™æœŸã§ã€ã‚ªãƒ•ã‚£ã‚¹å…¨ä½“ãŒãƒ”ãƒªãƒ”ãƒªã—ã¦ã„ã‚‹ã€‚", type: "busy" },
            { text: "æ¥­ç•Œæœ€å¤§æ‰‹ã®ä¸ç¥¥äº‹ãŒãƒ‹ãƒ¥ãƒ¼ã‚¹ã«ãªã‚Šã€é¡§å®¢å¯¾å¿œã«è¿½ã‚ã‚Œã¦ã„ã‚‹ã€‚", type: "trouble" },
            { text: "é–‘æ•£æœŸã«å…¥ã‚Šã€ç©ã‚„ã‹ãªç©ºæ°—ãŒæµã‚Œã¦ã„ã‚‹ã€‚", type: "calm" },
            { text: "æ–°å•†å“ãŒå¤§ãƒ’ãƒƒãƒˆã—ã€ç¤¾å†…ã¯ãŠç¥­ã‚Šé¨’ãã ã€‚", type: "good" },
            { text: "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ãŒæµè¡Œã—ã¦ãŠã‚Šã€ç©ºå¸­ãŒç›®ç«‹ã¤ã€‚", type: "bad" },
            { text: "å¤§å‹é€£ä¼‘ã‚’æ§ãˆã€ã©ã“ã‹æµ®è¶³ç«‹ã£ãŸé›°å›²æ°—ã ã€‚", type: "calm" },
            { text: "ç«¶åˆä»–ç¤¾ãŒæ–°ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç™ºè¡¨ã—ã€ç·Šæ€¥ä¼šè­°ãŒç¶šã„ã¦ã„ã‚‹ã€‚", type: "busy" },
            { text: "ä¸»è¦å–å¼•å…ˆã¨ã®å¥‘ç´„æ›´æ–°ãŒç„¡äº‹ã«å®Œäº†ã—ã€å®‰å µæ„ŸãŒåºƒãŒã£ã¦ã„ã‚‹ã€‚", type: "good" },
            { text: "ã‚·ã‚¹ãƒ†ãƒ ã®å¤§å‹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆä½œæ¥­ã§ã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ä»¥å¤–ã‚‚å¾…æ©ŸãŒç¶šãã€‚", type: "busy" },
            { text: "æ˜¥ã®é™½æ°—ã§ã€çª“ã®å¤–ã‚’çœºã‚ã‚‹ç¤¾å“¡ãŒå¤šã„ã€‚", type: "calm" },
            { text: "ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®é€šé”ãŒã‚ã‚Šã€å‚™å“ã®ä½¿ç”¨ã«ã‚‚åˆ¶é™ãŒã‹ã‹ã£ãŸã€‚", type: "bad" },
            { text: "ãƒœãƒ¼ãƒŠã‚¹æ”¯çµ¦æ—¥ãŒè¿‘ãã€çš†ã®è¡¨æƒ…ãŒæ˜ã‚‹ã„ã€‚", type: "good" }
        ];

        // åˆæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        const generateInitialStats = () => ({
            inst_fairness: Math.floor(40 + Math.random() * 30),
            inter_fairness: Math.floor(40 + Math.random() * 30),
            autonomy: Math.floor(40 + Math.random() * 30),
            competence: Math.floor(40 + Math.random() * 30),
            psych_load: Math.floor(30 + Math.random() * 30),
            phys_energy: Math.floor(50 + Math.random() * 40)
        });

        const ActionType = { WORK: 'work', COMMUNICATION: 'comm', REST: 'rest', WAIT: 'wait' };
        const pickMsg = (messages) => messages[Math.floor(Math.random() * messages.length)];

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒªã‚¹ãƒˆï¼ˆçœç•¥ã›ãšå…¨ã¦è¨˜è¿°ï¼‰
        const ACTIONS = [
            {
                id: 'praise', label: 'æˆæœã‚’è¤’ã‚ã‚‹', type: ActionType.COMMUNICATION, desc: 'å…·ä½“çš„ãªæˆæœã‚’æ‰¿èªã™ã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.2) return { diff: { inst_fairness: -5, inter_fairness: -10, competence: -5, psych_load: +20, phys_energy: 0 }, result: 'bad' };
                    return { diff: { inst_fairness: +5, inter_fairness: +15, autonomy: 0, competence: +20, psych_load: -10, phys_energy: 0 }, result: 'good' };
                },
                getMessages: (result) => result === 'good' ? ["ã€Œã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ãã“ã€ã“ã ã‚ã£ãŸã‚“ã§ã™ï¼ã€", "ã€Œéƒ¨é•·ã«ãã†è¨€ã£ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã€è‡ªä¿¡ã«ãªã‚Šã¾ã™ï¼ã€", "ã€Œã‚„ã£ãŸï¼æ¬¡ã¯ã‚‚ã£ã¨ã„ã„ã‚‚ã®ä½œã‚Šã¾ã™ã­ï¼ã€"] : ["ã€Œã‚ã€ã¯ã„...ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã§ã™ã­...ã€", "ã€ŒãŠä¸–è¾ã¯ã„ã„ã§ã™ã‚ˆ...ã€", "ã€Œçµæœã—ã‹è¦‹ã¦ãªã„ã‚“ã§ã™ã­...ã€"]
            },
            {
                id: 'scold', label: 'å³ã—ãæŒ‡å°', type: ActionType.WORK, desc: 'æ”¹å–„ç‚¹ã‚’æŒ‡æ‘˜ã—ä¿®æ­£ã•ã›ã‚‹',
                effect: (stats) => {
                    const successRate = stats.inter_fairness > 60 ? 0.7 : 0.3;
                    if (Math.random() < successRate) return { diff: { inst_fairness: +15, inter_fairness: 0, autonomy: -5, competence: +15, psych_load: +20, phys_energy: -10 }, result: 'good' };
                    return { diff: { inst_fairness: 0, inter_fairness: -30, autonomy: -10, competence: -20, psych_load: +40, phys_energy: -20 }, result: 'bad' };
                },
                getMessages: (result) => result === 'good' ? ["ã€Œç¢ºã‹ã«ãã†ã§ã™ã­...ã€‚æ¬¡ã‹ã‚‰ã¯çµ¶å¯¾ã«æ°—ã‚’ã¤ã‘ã¾ã™ï¼ã€", "ã€Œã”æŒ‡æ‘˜ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã™ãã«ä¿®æ­£ã—ã¾ã™ï¼ã€", "ã€Œã†ã£...ç—›ã„ã¨ã“ã‚ã‚’...ã€‚ã§ã‚‚ã€ãŠã£ã—ã‚ƒã‚‹é€šã‚Šã§ã™ã€‚ã€"] : ["ã€Œã™ã„ã¾ã›ã‚“...ï¼ˆãªã‚“ã§è‡ªåˆ†ã°ã£ã‹ã‚Š...ï¼‰ã€", "ã€Œ...ã¯ã„ã€ã‚ã‹ã‚Šã¾ã—ãŸã€‚ã€", "ã€Œï¼ˆã¾ãŸæ€’ã‚‰ã‚ŒãŸ...ã‚‚ã†å«Œã ãª...ï¼‰ã€"]
            },
            {
                id: 'delegate', label: 'ä»•äº‹ã‚’ä»»ã›ã‚‹', type: ActionType.WORK, desc: 'æ¨©é™å§”è­²ã—ã¦è¦‹å®ˆã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.3) return { diff: { inst_fairness: -10, inter_fairness: -10, autonomy: +5, competence: -10, psych_load: +30, phys_energy: -20 }, result: 'bad' };
                    return { diff: { inst_fairness: 0, inter_fairness: +5, autonomy: +25, competence: +15, psych_load: +15, phys_energy: -15 }, result: 'good' };
                },
                getMessages: (result) => result === 'good' ? ["ã€Œã“ã‚Œã€åƒ•ãŒã‚„ã£ã¦ã„ã„ã‚“ã§ã™ã‹ï¼Ÿ ã‚„ã‚Šã¾ã™ï¼ã€", "ã€Œè²¬ä»»é‡å¤§ã§ã™ã­...ã§ã‚‚ã€ãƒãƒ£ãƒ³ã‚¹ã ã¨æ€ã£ã¦é ‘å¼µã‚Šã¾ã™ï¼ã€", "ã€Œä»»ã›ã¦ãã ã•ã„ï¼æœŸå¾…ä»¥ä¸Šã®çµæœã‚’å‡ºã—ã¦ã¿ã›ã¾ã™ã‚ˆã€‚ã€"] : ["ã€Œãˆã€ã“ã‚Œåƒ•ãŒã‚„ã‚‹ã‚“ã§ã™ã‹...ï¼Ÿã€", "ã€Œä¸¸æŠ•ã’ã§ã™ã‹...ã‚ã‹ã‚Šã¾ã—ãŸ...ã€", "ã€Œä»Šã®æ¥­å‹™é‡ã§ã“ã‚Œä»¥ä¸Šã¯...ã€"]
            },
            {
                id: 'micro_manage', label: 'ç´°ã‹ãæŒ‡ç¤ºå‡ºã—', type: ActionType.WORK, desc: 'é€²æ—ã‚’ç´°éƒ¨ã¾ã§ç®¡ç†ã™ã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.2) return { diff: { inst_fairness: +10, inter_fairness: +10, autonomy: -10, competence: 0, psych_load: -10, phys_energy: -5 }, result: 'good' };
                    return { diff: { inst_fairness: +10, inter_fairness: -5, autonomy: -30, competence: -10, psych_load: +10, phys_energy: -10 }, result: 'bad' };
                },
                getMessages: (result) => result === 'good' ? ["ã€Œç´°ã‹ãè¦‹ã¦ã‚‚ã‚‰ãˆã¦åŠ©ã‹ã‚Šã¾ã™ï¼è¿·ã‚ãšã«é€²ã‚ãã†ã§ã™ã€‚ã€", "ã€Œä¸€äººã ã¨ä¸å®‰ã ã£ãŸã®ã§ã€æŒ‡ç¤ºãŒã‚ã£ã¦å®‰å¿ƒã—ã¾ã—ãŸã€‚ã€"] : ["ã€Œã‚ã€ã¯ã„ã€‚ãã®é€šã‚Šã«é€²ã‚ã¾ã™...ã€", "ã€Œå ±å‘Šã§ã™ã­ã€‚ãˆãˆã¨ã€ä»Šã¯...ã€", "ã€Œç´°éƒ¨ã¾ã§ç¢ºèªã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™...ã€"]
            },
            {
                id: 'listen', label: '1on1ã§å‚¾è´', type: ActionType.COMMUNICATION, desc: 'ä¸æº€ã‚„ã‚­ãƒ£ãƒªã‚¢ã®ç›¸è«‡ã«ä¹—ã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.1) return { diff: { inst_fairness: -15, inter_fairness: -5, autonomy: 0, competence: 0, psych_load: +5, phys_energy: 0 }, result: 'bad' };
                    return { diff: { inst_fairness: +5, inter_fairness: +25, autonomy: +5, competence: +5, psych_load: -20, phys_energy: 0 }, result: 'good' };
                },
                getMessages: (result) => result === 'good' ? ["ã€Œå®Ÿã¯æœ€è¿‘ã€å°‘ã—æ‚©ã‚“ã§ã„ã¦...ã€", "ã€Œéƒ¨é•·ã¨ã“ã†ã—ã¦è©±ã›ã‚‹ã¨ã€é ­ã®ä¸­ãŒæ•´ç†ã§ãã¾ã™ã€‚ã€", "ã€Œã‚ãƒ¼ã€ã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸï¼ èã„ã¦ã‚‚ã‚‰ãˆã¦ã‚ˆã‹ã£ãŸã§ã™ã€‚ã€"] : ["ã€Œèãã ã‘ãªã‚‰èª°ã§ã‚‚ã§ãã¾ã™ã‚ˆã­...ã€", "ã€Œè©±ã—ã¦ã‚‚ç„¡é§„ã§ã—ãŸã­...ã€"]
            },
            {
                id: 'rest', label: 'ä¼‘æ¯ã‚’ä¿ƒã™', type: ActionType.REST, desc: 'æ—©å¸°ã‚Šã‚’æ¨å¥¨ã™ã‚‹',
                effect: (stats) => {
                    if (Math.random() < 0.2) return { diff: { inst_fairness: 0, inter_fairness: -5, autonomy: -10, competence: 0, psych_load: +15, phys_energy: +5 }, result: 'bad' };
                    return { diff: { inst_fairness: 0, inter_fairness: +10, autonomy: 0, competence: 0, psych_load: -20, phys_energy: +30 }, result: 'good' };
                },
                getMessages: (result) => result === 'good' ? ["ã€Œãˆã€ã„ã„ã‚“ã§ã™ã‹ï¼Ÿ ã˜ã‚ƒã‚ã€ãŠè¨€è‘‰ã«ç”˜ãˆã¦...ã€", "ã€ŒåŠ©ã‹ã‚Šã¾ã™...æœ€è¿‘ã¡ã‚‡ã£ã¨å¯ä¸è¶³æ°—å‘³ã ã£ãŸã®ã§ã€‚ã€", "ã€Œã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦ãã¾ã™ï¼ã€"] : ["ã€Œä»Šå¸°ã‚Œã£ã¦è¨€ã‚ã‚Œã¦ã‚‚ã€æ˜æ—¥å›°ã‚‹ã ã‘ãªã‚“ã§ã™ã‘ã©...ã€", "ã€Œã¯ã‚...ã‚ã‹ã‚Šã¾ã—ãŸï¼ˆå®¶ã§ã‚„ã‚ã†...ï¼‰ã€"]
            },
            {
                id: 'drink', label: 'é£²ã¿ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', type: ActionType.REST, desc: 'è…¹ã‚’å‰²ã£ã¦è©±ã™',
                effect: (stats) => {
                    if (Math.random() < 0.5) return { diff: { inst_fairness: 0, inter_fairness: -15, autonomy: 0, competence: 0, psych_load: +15, phys_energy: -20 }, result: 'bad' };
                    return { diff: { inst_fairness: 0, inter_fairness: +30, autonomy: 0, competence: +10, psych_load: -15, phys_energy: -10 }, result: 'good' };
                },
                getMessages: (result) => result === 'good' ? ["ã€Œã„ã‚„ãƒ¼ã€éƒ¨é•·ãŒãã‚“ãªéå»ã‚’æŒã£ã¦ãŸã¨ã¯ï¼é¢ç™½ã„ã§ã™ï¼ã€", "ã€Œã¶ã£ã¡ã‚ƒã‘ã¾ã™ã‘ã©...éƒ¨é•·ã®ã“ã¨ã€æœ€åˆã¯æ€–ã‹ã£ãŸã‚“ã§ã™ã‚ˆï¼ˆç¬‘ï¼‰ã€", "æœ€é«˜ã«ç››ã‚Šä¸ŠãŒã‚Šã€å›ºã„æ¡æ‰‹ã‚’äº¤ã‚ã—ã¦åˆ¥ã‚ŒãŸã€‚"] : ["ã€Œã‚ã€æ˜æ—¥æ—©ã„ã‚“ã§ã€ãã‚ãã‚...ã€", "ã€Œã¯ã¯...ãã†ã§ã™ã­...ã€", "ã€Œã™ã„ã¾ã›ã‚“ã€ã¡ã‚‡ã£ã¨é…”ã„ãŒå›ã£ã¡ã‚ƒã£ã¦...ã€"]
            },
            {
                id: 'wait', label: 'ãã£ã¨ã—ã¦ãŠã', type: ActionType.WAIT, desc: 'ä½•ã‚‚ã›ãšæ§˜å­ã‚’è¦‹ã‚‹',
                effect: (stats) => {
                    const rand = Math.random();
                    if (rand < 0.3) return { diff: { inst_fairness: 0, inter_fairness: 0, autonomy: +10, competence: +5, psych_load: -10, phys_energy: +10 }, result: 'good' };
                    else if (rand < 0.6) return { diff: { inst_fairness: -5, inter_fairness: -10, autonomy: 0, competence: -5, psych_load: +10, phys_energy: 0 }, result: 'bad' };
                    return { diff: { inst_fairness: 0, inter_fairness: 0, autonomy: 0, competence: 0, psych_load: 0, phys_energy: 0 }, result: 'none' };
                },
                getMessages: (result) => result === 'good' ? ["éƒ¨ä¸‹ã¯è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§ä»•äº‹ã‚’é€²ã‚ã€èª¿å­ã‚’å–ã‚Šæˆ»ã—ãŸã‚ˆã†ã ã€‚", "ä½™è¨ˆãªå¹²æ¸‰ã‚’ã—ãªã‹ã£ãŸã“ã¨ã§ã€éƒ¨ä¸‹ã¯ã®ã³ã®ã³ã¨ã—ã¦ã„ã‚‹ã€‚", "å°‘ã—ä¼‘æ†©ã—ã¦ã„ãŸã‚ˆã†ã ãŒã€ãã®å¾Œé›†ä¸­ã—ã¦ã‚¿ã‚¹ã‚¯ã‚’ç‰‡ä»˜ã‘ãŸã€‚"] : result === 'bad' ? ["éƒ¨ä¸‹ã¯æ‰‹æŒã¡ç„¡æ²™æ±°ã«ã—ã¦ã„ã‚‹...ã€Œæ”¾ç½®ã•ã‚Œã¦ã„ã‚‹ã€ã¨æ„Ÿã˜ãŸã‚ˆã†ã ã€‚", "å›°ã£ã¦ã„ã‚‹ã‚ˆã†ã ãŒã€å£°ã‚’ã‹ã‘ãªã‹ã£ãŸãŸã‚ãƒŸã‚¹ãŒç™ºç”Ÿã—ã¦ã—ã¾ã£ãŸã€‚", "èª°ã¨ã‚‚ä¼šè©±ã›ãšä¸€æ—¥ãŒçµ‚ã‚ã‚Šã€éƒ¨ä¸‹ã¯å­¤ç‹¬ã‚’æ„Ÿã˜ã¦ã„ã‚‹ã€‚"] : ["ç‰¹ã«å¤‰ã‚ã£ãŸæ§˜å­ã¯ãªã„ã€‚æ·¡ã€…ã¨æ™‚é–“ãŒéããŸã€‚", "éƒ¨ä¸‹ã¯é»™ã€…ã¨ä½œæ¥­ã‚’ã—ã¦ã„ã‚‹ã€‚è‰¯ãã‚‚æ‚ªãã‚‚å¤‰åŒ–ã¯ãªã„ã€‚", "çª“ã®å¤–ã‚’çœºã‚ã¦ã„ã‚‹...ä½•ã‚’è€ƒãˆã¦ã„ã‚‹ã®ã ã‚ã†ã‹ã€‚"]
            }
        ];

        const RANDOM_EVENTS = [
            { title: "ä¸é€æ˜ãªäººäº‹ç•°å‹•", desc: "ã€Œãªã‚“ã§ã‚ã®äººãŒæ˜‡é€²ã™ã‚‹ã‚“ã§ã™ã‹...ï¼Ÿã€éƒ¨ä¸‹ãŒä¸ä¿¡æ„Ÿã‚’æŠ±ã„ã¦ã„ã‚‹ã€‚", effect: { inst_fairness: -15, inter_fairness: 0, autonomy: 0, competence: 0, psych_load: +5, phys_energy: 0 } },
            { title: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¤§æˆåŠŸ", desc: "ã€Œã‚„ã‚Šã¾ã—ãŸã­éƒ¨é•·ï¼ç§ãŸã¡æœ€é«˜ã˜ã‚ƒãªã„ã§ã™ã‹ï¼ï¼Ÿã€", effect: { inst_fairness: +5, inter_fairness: 0, autonomy: 0, competence: +15, psych_load: -5, phys_energy: -5 } },
            { title: "ç¹å¿™æœŸçªå…¥", desc: "ã€Œçµ‚ã‚ã‚‰ãªã„...å…¨ç„¶ä»•äº‹ãŒçµ‚ã‚ã‚‰ãªã„ã§ã™ã‚ˆ...ã€", effect: { inst_fairness: 0, inter_fairness: 0, autonomy: -5, competence: 0, psych_load: +10, phys_energy: -15 } },
            { title: "ç†ä¸å°½ãªã‚¯ãƒ¬ãƒ¼ãƒ ", desc: "ã€Œç§ã€ä½•ã‚‚æ‚ªããªã„ã®ã«...ã‚‚ã†ç–²ã‚Œã¾ã—ãŸ...ã€", effect: { inst_fairness: 0, inter_fairness: 0, autonomy: -5, competence: -5, psych_load: +15, phys_energy: -10 } },
            { title: "æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã®å°å…¥", desc: "ã€Œã“ã‚Œå‡„ã„ï¼é¢å€’ãªä½œæ¥­ãŒä¸€ç¬ã§çµ‚ã‚ã‚Šã¾ã™ï¼ã€", effect: { inst_fairness: +5, inter_fairness: 0, autonomy: +5, competence: +5, psych_load: -5, phys_energy: +5 } }
        ];

        function SubordinateSurvival() {
            const [gameState, setGameState] = useState('start'); 
            const [week, setWeek] = useState(1);
            const [stats, setStats] = useState(generateInitialStats());
            const [parameterChanges, setParameterChanges] = useState({});
            const [lastMessage, setLastMessage] = useState("");
            const [eventMessage, setEventMessage] = useState(null);
            const [history, setHistory] = useState([]);
            // å±¥æ­´åˆ†æç”¨ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿
            const [statsHistory, setStatsHistory] = useState([]);
            const [currentActions, setCurrentActions] = useState([]);
            const [gameOverReason, setGameOverReason] = useState("");
            const [currentSituation, setCurrentSituation] = useState(WEEKLY_SITUATIONS[0]);
            const [score, setScore] = useState(0); 
            const logsEndRef = useRef(null);

            useEffect(() => { logsEndRef.current?.scrollIntoView({ behavior: "smooth" }); }, [history]);

            // --- ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ç¾¤ ---
            const calculateScore = (s) => Math.floor((s.inst_fairness + s.inter_fairness + s.autonomy + s.competence + (100 - s.psych_load) + s.phys_energy) / 6);

            const determineMentalStateId = (s) => {
                if (s.inst_fairness <= 0 || s.inter_fairness <= 0 || s.autonomy <= 0 || s.competence <= 0 || s.phys_energy <= 0 || s.psych_load >= 100) return 'turnover';
                const avgScore = calculateScore(s);
                if (avgScore <= 30) return 'turnover';
                if (avgScore <= 40) return 'apathy';
                if (avgScore <= 50) return 'quiet_quit';
                if (avgScore <= 65) return 'resignation';
                if (avgScore <= 80) return 'conflict';
                if (avgScore < 95) return 'waver';
                if (s.inst_fairness >= 95 && s.inter_fairness >= 95 && s.autonomy >= 95 && s.competence >= 95 && s.phys_energy >= 95 && s.psych_load <= 5) return 'growth';
                return 'waver';
            };

            const updateWeeklySituation = () => {
                const situation = WEEKLY_SITUATIONS[Math.floor(Math.random() * WEEKLY_SITUATIONS.length)];
                setCurrentSituation(situation);
                return situation;
            };

            const startGame = () => {
                const initialStats = generateInitialStats();
                setStats(initialStats); 
                setParameterChanges({});
                setWeek(1);
                setGameState('playing');
                setLastMessage("ã€Œä»ŠæœŸã‚‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€éƒ¨é•·ï¼ã€");
                setEventMessage(null);
                setHistory([]);
                setStatsHistory([{ week: 0, stats: initialStats, action: "é–‹å§‹", score: calculateScore(initialStats) }]); // åˆæœŸçŠ¶æ…‹è¨˜éŒ²
                updateWeeklySituation();
                pickRandomActions();
            };

            const pickRandomActions = () => {
                const shuffled = [...ACTIONS].sort(() => 0.5 - Math.random());
                setCurrentActions(shuffled.slice(0, 3));
            };

            const handleAction = (action) => {
                const { diff: changes, result } = action.effect(stats);
                let newStats = { ...stats };
                Object.keys(changes).forEach(key => { newStats[key] += changes[key]; });
                Object.keys(newStats).forEach(key => { newStats[key] = Math.max(0, Math.min(100, newStats[key])); });

                setParameterChanges(changes);
                setStats(newStats);

                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†
                const possibleMessages = action.getMessages(result);
                const actionMsg = pickMsg(possibleMessages);
                setLastMessage(actionMsg);
                
                let historyColor = 'text-gray-700';
                if (result === 'good') historyColor = 'text-green-700 font-bold';
                if (result === 'bad') historyColor = 'text-red-700 font-bold';

                const newHistory = [...history, { week, type: 'action', text: `${action.label} â†’ ${actionMsg}`, className: historyColor }];
                
                // ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
                let evtMsg = null;
                if (Math.random() < 0.25 && week < MAX_WEEKS) {
                    const evt = RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)];
                    Object.keys(evt.effect).forEach(key => { newStats[key] += evt.effect[key]; });
                    Object.keys(newStats).forEach(key => { newStats[key] = Math.max(0, Math.min(100, newStats[key])); });
                    evtMsg = evt;
                    newHistory.push({ week, type: 'event', text: `âš¡ ${evt.desc}` });
                }
                setEventMessage(evtMsg);
                setHistory(newHistory);

                // çµ±è¨ˆå±¥æ­´ã®ä¿å­˜
                setStatsHistory(prev => [...prev, { 
                    week, 
                    stats: {...newStats}, 
                    action: action.label, 
                    result, 
                    event: evtMsg ? evtMsg.title : null,
                    score: calculateScore(newStats)
                }]);

                checkGameState(newStats, week);
            };

            const checkGameState = (currentStats, currentWeek) => {
                const currentState = determineMentalStateId(currentStats);
                if (currentState === 'turnover') { finishGame('turnover', currentStats); return; }
                if (currentWeek >= MAX_WEEKS) {
                    if (['quiet_quit', 'apathy', 'turnover'].includes(currentState)) { finishGame('quiet_quit_end', currentStats); } 
                    else { finishGame('victory', currentStats); }
                } else {
                    setWeek(prev => prev + 1);
                    updateWeeklySituation(); 
                    pickRandomActions();
                }
            };

            const finishGame = (reason, finalStats) => {
                let reasonText = "";
                let calculatedScore = reason === 'victory' ? calculateScore(finalStats) : 0;

                switch(reason) {
                    case 'turnover': 
                        if(finalStats.inst_fairness <= 0 || finalStats.inter_fairness <= 0 || finalStats.autonomy <= 0 || finalStats.competence <= 0 || finalStats.phys_energy <= 0) reasonText = "é™ç•Œã‚’è¶…ãˆã¾ã—ãŸã€‚ä½•ã‹ãŒæ¬ è½ã—ã€éƒ¨ä¸‹ã¯å»ã‚Šã¾ã—ãŸã€‚";
                        else if(finalStats.psych_load >= 90) reasonText = "ãƒ¡ãƒ³ã‚¿ãƒ«ä¸èª¿ã«ã‚ˆã‚Šä¼‘è·é¡˜ãŒæå‡ºã•ã‚Œã¾ã—ãŸã€‚";
                        else if(finalStats.phys_energy <= 10) reasonText = "éåŠ´ã«ã‚ˆã‚Šå€’ã‚Œã€æ•‘æ€¥æ¬é€ã•ã‚Œã¾ã—ãŸã€‚";
                        else reasonText = "ã€Œã“ã®ä¼šç¤¾ã«ã¯æœªæ¥ãŒã‚ã‚Šã¾ã›ã‚“ã€ã¨é€€è·å±ŠãŒå‡ºã•ã‚Œã¾ã—ãŸã€‚";
                        break;
                    case 'quiet_quit_end':
                        reasonText = "æœŸé–“æº€äº†ã§ã™ãŒã€éƒ¨ä¸‹ã¯å®Œå…¨ã«ã‚„ã‚‹æ°—ã‚’å¤±ã£ã¦ã„ã¾ã™ã€‚äº‹å®Ÿä¸Šã®ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæ•—åŒ—ã§ã™ã€‚";
                        break;
                    case 'victory':
                        reasonText = "éƒ¨ä¸‹ã¯ç´ æ™´ã‚‰ã—ã„çŠ¶æ…‹ã§æœŸã‚’çµ‚ãˆã¾ã—ãŸã€‚ä¿¡é ¼é–¢ä¿‚ã¯ç›¤çŸ³ã§ã™ï¼";
                        break;
                }
                setScore(calculatedScore);
                setGameOverReason(reasonText);
                setGameState(reason === 'victory' ? 'victory' : 'gameover');
            };

            // åˆ†æç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
            const copyAnalysisData = () => {
                const header = "Week,Action,Event,Score,InstFairness,InterFairness,Autonomy,Competence,PsychLoad,PhysEnergy\n";
                const rows = statsHistory.map(h => 
                    `${h.week},${h.action},${h.event || ''},${h.score},${h.stats.inst_fairness},${h.stats.inter_fairness},${h.stats.autonomy},${h.stats.competence},${h.stats.psych_load},${h.stats.phys_energy}`
                ).join("\n");
                navigator.clipboard.writeText(header + rows).then(() => alert("åˆ†æç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼Excelç­‰ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚"));
            };

            // ç°¡æ˜“ã‚°ãƒ©ãƒ•æç”»ç”¨
            const renderGraph = () => {
                if (statsHistory.length < 2) return null;
                const width = 100; 
                const height = 50;
                const points = statsHistory.map((h, i) => {
                    const x = (i / (statsHistory.length - 1)) * width;
                    const y = height - (h.score / 100 * height);
                    return `${x},${y}`;
                }).join(" ");

                return (
                    <div className="w-full h-24 bg-slate-50 border border-slate-200 rounded p-2 relative mt-4">
                        <div className="text-xs text-gray-400 absolute top-0 left-1">Scoreæ¨ç§»</div>
                        <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full overflow-visible" preserveAspectRatio="none">
                            <polyline fill="none" stroke="#3b82f6" strokeWidth="2" points={points} />
                            {statsHistory.map((h, i) => (
                                <circle key={i} cx={(i / (statsHistory.length - 1)) * width} cy={height - (h.score / 100 * height)} r="1.5" fill="#3b82f6" />
                            ))}
                        </svg>
                    </div>
                );
            };

            const currentMentalStateId = determineMentalStateId(stats);
            const currentStateIndex = MENTAL_STATES.findIndex(s => s.id === currentMentalStateId);
            const rotationAngle = currentStateIndex * (360 / MENTAL_STATES.length); 

            // --- UI ---
            const ProgressBar = ({ label, value, change, color }) => (
                <div className="mb-2.5 w-full">
                    <div className="flex justify-between items-end text-xs text-white mb-0.5 px-0.5">
                        <span className="font-medium bg-slate-900/50 px-1 rounded">{label}</span>
                        <div className="flex gap-1 items-baseline">
                            {change !== 0 && change !== undefined && (<span className={`text-[10px] ${change > 0 ? 'text-green-300' : 'text-red-300'}`}>{change > 0 ? 'â–²' : 'â–¼'}{Math.abs(change)}</span>)}
                            <span className="font-mono font-bold text-sm">{value}</span>
                        </div>
                    </div>
                    <div className="w-full bg-slate-700/50 h-2.5 rounded-sm overflow-hidden backdrop-blur-sm border border-slate-600/50">
                        <div className="h-full transition-all duration-500 rounded-sm" style={{ width: `${value}%`, backgroundColor: color }} />
                    </div>
                </div>
            );

            return (
                <div className="w-full max-w-6xl h-full bg-white rounded-xl shadow-2xl overflow-hidden border border-slate-200 flex flex-col">
                    <div className="bg-slate-800 text-white p-4 flex justify-between items-center shrink-0">
                        <h1 className="font-bold text-lg flex items-center gap-2"><Briefcase size={20} /> æ„Ÿæƒ…ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ </h1>
                        <div className="text-sm bg-slate-700 px-3 py-1 rounded-full font-mono">Week {gameState === 'start' ? 1 : week} / {MAX_WEEKS}</div>
                    </div>

                    {gameState === 'start' && (
                        <div className="p-8 text-center flex-1 flex flex-col justify-center items-center">
                            <div className="mb-6 text-7xl">ğŸ¢</div>
                            <h2 className="text-3xl font-bold mb-4">æ„Ÿæƒ…ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ  </h2>
                            <p className="text-gray-600 mb-8 leading-relaxed text-base max-w-lg">
                                ã‚ãªãŸã¯ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¨ã—ã¦ã€éƒ¨ä¸‹ã®6ã¤ã®å¿ƒç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç®¡ç†ã—ã¾ã™ã€‚<br/>
                                ã“ã®ç ”ä¿®ã§ã¯ã€ç›´æ„Ÿçš„ãªãƒ—ãƒ¬ã‚¤ã®å¾Œã«<br/><strong>ã€Œãªãœãã®çµæœã«ãªã£ãŸã‹ã€ã‚’ãƒ‡ãƒ¼ã‚¿ã§æŒ¯ã‚Šè¿”ã‚‹</strong>ãƒ—ãƒ­ã‚»ã‚¹ã‚’é‡è¦–ã—ã¾ã™ã€‚<br/>
                                ã¾ãšã¯ç¬¬1æœŸã€ã‚ãªãŸã®ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
                            </p>
                            <button onClick={startGame} className="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-lg text-lg transition active:scale-95">ç¬¬1æœŸ çµŒå–¶é–‹å§‹</button>
                        </div>
                    )}

                    {gameState === 'playing' && (
                        <div className="flex flex-col md:flex-row h-full overflow-hidden">
                            <div className="flex-1 bg-slate-50/50 flex flex-col items-center justify-center p-4 relative border-r border-slate-200">
                                <div className="relative w-[400px] h-[400px] flex items-center justify-center transform scale-90 md:scale-100">
                                    <div className="absolute w-full h-full flex items-center justify-center transition-transform duration-1000 ease-in-out" style={{ transform: `rotate(${rotationAngle}deg)` }}>
                                        <div className="absolute w-[340px] h-[340px] rounded-full border-2 border-dashed border-slate-300"></div>
                                        {MENTAL_STATES.map((state, index) => {
                                            const angle = -index * (360 / MENTAL_STATES.length);
                                            const radius = 170; 
                                            const isActive = state.id === currentMentalStateId;
                                            return (
                                                <div key={state.id} className="absolute flex flex-col items-center justify-center text-center transition-all duration-500" style={{ top: '50%', left: '50%', marginTop: '-3rem', marginLeft: '-3rem', transform: `rotate(${angle}deg) translate(0, -${radius}px) rotate(${-angle}deg) rotate(${-rotationAngle}deg)` }}>
                                                    <div className={`w-24 h-24 rounded-full flex flex-col items-center justify-center shadow-lg border-2 transition-all duration-500 ${isActive ? 'scale-110 ring-4 ring-offset-2 ring-yellow-200 font-bold z-10' : 'bg-white/90 border-slate-300 opacity-60'}`} style={{ backgroundColor: isActive ? state.colorBg : undefined, borderColor: isActive ? state.colorBorder : undefined }}>
                                                        <span className="text-sm text-slate-800 leading-tight px-2">{state.label}</span>
                                                        {state.subLabel && <span className="text-[10px] text-slate-500 mt-1">{state.subLabel}</span>}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <div className="absolute w-64 h-64 bg-slate-800 rounded-full flex flex-col justify-center px-8 shadow-2xl z-30 border-4 border-slate-600">
                                        <ProgressBar label="å…¬å¹³æ€§(åˆ¶åº¦)" value={stats.inst_fairness} change={parameterChanges.inst_fairness} color="#60A5FA" />
                                        <ProgressBar label="å…¬å¹³æ€§(å¯¾äºº)" value={stats.inter_fairness} change={parameterChanges.inter_fairness} color="#818CF8" />
                                        <ProgressBar label="è£é‡æ„Ÿ" value={stats.autonomy} change={parameterChanges.autonomy} color="#4ADE80" />
                                        <ProgressBar label="æœ‰ç”¨æ„Ÿ" value={stats.competence} change={parameterChanges.competence} color="#2DD4BF" />
                                        <ProgressBar label="å¿ƒç†çš„è² è·" value={stats.psych_load} change={parameterChanges.psych_load} color="#F472B6" />
                                        <ProgressBar label="èº«ä½“ã‚¨ãƒŠã‚¸ãƒ¼" value={stats.phys_energy} change={parameterChanges.phys_energy} color="#FB923C" />
                                    </div>
                                </div>
                            </div>

                            <div className="flex-1 flex flex-col min-w-0 bg-white z-20">
                                <div className="flex-1 overflow-y-auto p-6 flex flex-col justify-center">
                                    <div className="w-full mb-4">
                                        <div className="flex items-center gap-2 text-xs font-bold text-slate-400 mb-1 uppercase tracking-wider"><TrendingUp size={14} /> ä»Šé€±ã®è·å ´ç’°å¢ƒ / æ¥­ç•Œãƒ‹ãƒ¥ãƒ¼ã‚¹</div>
                                        <div className={`p-3 rounded-lg border-l-4 text-sm font-medium ${currentSituation.type === 'busy' || currentSituation.type === 'trouble' || currentSituation.type === 'bad' ? 'bg-red-50 border-red-400 text-red-800' : currentSituation.type === 'good' ? 'bg-blue-50 border-blue-400 text-blue-800' : 'bg-gray-50 border-gray-400 text-gray-700'}`}>{currentSituation.text}</div>
                                    </div>
                                    <div className="w-full mb-6">
                                        <div className="bg-slate-100 px-6 py-4 rounded-xl text-base text-slate-700 w-full text-center border border-slate-200 min-h-[4rem] flex items-center justify-center shadow-inner italic relative">
                                            <span className="absolute top-2 left-2 text-3xl text-slate-200">"</span>{lastMessage}<span className="absolute bottom-2 right-2 text-3xl text-slate-200">"</span>
                                        </div>
                                        {eventMessage && <div className="bg-yellow-50 px-4 py-3 mt-2 rounded-lg text-sm text-yellow-800 text-center border border-yellow-200 animate-pulse font-bold flex items-center justify-center gap-2"><Zap size={16} /> {eventMessage.title}: {eventMessage.desc}</div>}
                                    </div>
                                    <div className="w-full space-y-3">
                                        <h3 className="text-sm font-bold text-gray-500 mb-2 flex items-center gap-2"><Briefcase size={16} /> ä»Šé€±ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                                        <div className="grid grid-cols-1 gap-3">
                                            {currentActions.map((action) => (
                                                <button key={action.id} onClick={() => handleAction(action)} className="w-full text-left bg-white hover:bg-blue-50 border-2 border-slate-200 hover:border-blue-500 p-4 rounded-xl transition-all duration-200 group relative overflow-hidden shadow-sm active:scale-[0.99]">
                                                    <div className="flex justify-between items-center relative z-10">
                                                        <div className="flex-1 min-w-0 pr-4"><span className="font-bold text-slate-800 text-base block mb-1">{action.label}</span><span className="text-xs text-slate-500 block">{action.desc}</span></div>
                                                        <div className="bg-slate-50 text-slate-400 p-3 rounded-full group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors shrink-0">{action.type === ActionType.COMMUNICATION && <MessageCircle size={20} />}{action.type === ActionType.WORK && <Briefcase size={20} />}{action.type === ActionType.REST && <Coffee size={20} />}{action.type === ActionType.WAIT && <Eye size={20} />}</div>
                                                    </div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-slate-50 border-t border-slate-200 p-3 h-40 shrink-0">
                                    <h4 className="text-xs font-bold text-gray-500 mb-2 flex items-center gap-1"><History size={12} /> æ´»å‹•å±¥æ­´</h4>
                                    <div className="h-full overflow-y-auto pb-6 text-xs space-y-2 pr-2 custom-scrollbar">
                                        {history.length === 0 ? <p className="text-gray-400 italic text-center py-4">å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</p> : history.map((log, i) => (<div key={i} className={`p-2 rounded border ${log.type === 'event' ? 'bg-yellow-50 border-yellow-200 text-yellow-800' : 'bg-white border-slate-200'} ${log.className || 'text-gray-700'}`}><span className="font-mono font-bold text-gray-400 mr-2 border-r border-gray-200 pr-2">W{log.week}</span>{log.text}</div>))}
                                        <div ref={logsEndRef} />
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {(gameState === 'gameover' || gameState === 'victory') && (
                        <div className={`p-12 text-center flex-1 flex flex-col justify-center items-center ${gameState === 'victory' ? 'bg-blue-50' : 'bg-red-50'} overflow-y-auto`}>
                            {gameState === 'victory' ? (
                                <><Award size={80} className="mx-auto text-yellow-500 mb-4" /><h2 className="text-3xl font-bold text-blue-900 mb-2">QUARTER COMPLETE!</h2><div className="text-5xl font-bold text-blue-600 mb-4">{score}<span className="text-2xl text-blue-400">ç‚¹</span></div><p className="text-blue-700 mb-8 text-lg">ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæˆåŠŸã§ã™ã€‚ç´ æ™´ã‚‰ã—ã„ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã§ã—ãŸï¼</p></>
                            ) : (
                                <>{gameOverReason.includes("é™ã‹ãªé€€è·") ? <Ghost size={80} className="mx-auto text-gray-500 mb-4" /> : <UserMinus size={80} className="mx-auto text-red-500 mb-4" />}<h2 className="text-3xl font-bold text-red-800 mb-2">GAME OVER</h2><div className="text-5xl font-bold text-gray-400 mb-4">0<span className="text-2xl text-gray-300">ç‚¹</span></div><div className="bg-white p-6 rounded-xl shadow-md border border-red-100 mb-6 text-left relative mt-4 max-w-lg w-full"><div className="absolute -top-3 left-6 bg-red-100 text-red-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">{gameOverReason.includes("é™ã‹ãªé€€è·") ? "ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆå¤±æ•—" : "é€€è·/ä¼‘è·å±Š"}</div><p className="text-gray-700 font-serif italic text-lg leading-relaxed mt-2">"{gameOverReason}"</p></div></>
                            )}
                            
                            <div className="w-full max-w-lg mb-8">
                                <h3 className="text-sm font-bold text-gray-600 mb-2 text-left flex items-center gap-2"><BarChart size={16}/> ã‚¹ã‚³ã‚¢æ¨ç§»ï¼ˆæŒ¯ã‚Šè¿”ã‚Šç”¨ï¼‰</h3>
                                {renderGraph()}
                                <button onClick={copyAnalysisData} className="mt-4 w-full bg-white hover:bg-gray-50 text-slate-700 border border-slate-300 font-bold py-2 px-4 rounded flex items-center justify-center gap-2 transition"><Copy size={16} /> ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆCSVå½¢å¼ï¼‰</button>
                                <p className="text-xs text-gray-400 mt-2 text-left">â€» ã‚³ãƒ”ãƒ¼ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯Excelãªã©ã«è²¼ã‚Šä»˜ã‘ã¦åˆ†æã§ãã¾ã™ã€‚</p>
                            </div>

                            <button onClick={startGame} className={`px-8 py-4 text-white font-bold rounded-lg shadow-lg text-lg transition flex items-center gap-2 ${gameState === 'victory' ? 'bg-blue-600 hover:bg-blue-700' : 'bg-slate-800 hover:bg-slate-900'}`}><RefreshCw size={20} /> {gameState === 'victory' ? 'æ¬¡ã®æœŸã¸' : 'å†æŒ‘æˆ¦ï¼ˆåˆæœŸå€¤ãƒ©ãƒ³ãƒ€ãƒ ï¼‰'}</button>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SubordinateSurvival />);
    </script>
</body>
</html>
